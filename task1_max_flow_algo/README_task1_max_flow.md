# Task 1 — Алгоритм максимального потоку (Едмондса–Карпа)

## Постановка задачі

Є логістична мережа, яка складається з:

- 2 терміналів: **Термінал 1**, **Термінал 2**;
- 4 складів: **Склад 1–4**;
- 14 магазинів: **Магазин 1–14**.

Мережа задається орієнтованим графом із пропускними здатностями ребер:

- Термінали → Склади — задають, скільки товару може піти з термінала на кожен склад.
- Склади → Магазини — задають, скільки товару кожен склад може відправити в конкретний магазин.

Мета — знайти **максимальний потік товарів** від терміналів до магазинів, використовуючи алгоритм **Едмондса–Карпа** (варіант алгоритму Форда–Фалкерсона на основі BFS).

## Модель графа

Для реалізації задачі граф розширюється:

- додається **надджерело `S`**, яке з'єднане з терміналами;
- додається **надстік `T`**, до якого підключені всі магазини.

Основні типи вершин:

- `S` — джерело,
- `T1`, `T2` — термінали,
- `W1`, `W2`, `W3`, `W4` — склади,
- `Shop1` … `Shop14` — магазини,
- `T` — стік.

Ребра:

- `S -> T1`, `S -> T2` — їхні ємності дорівнюють сумі вихідних ребер з відповідного термінала (щоб S не давав додаткових обмежень).
- `T1/T2 -> W1–W4` — за умовою задачі.
- `W1–W4 -> Shop1–Shop14` — за умовою задачі.
- `ShopX -> T` — з ємністю, рівною ємності ребра `W? -> ShopX`, щоб магазин не споживав більше, ніж може бути доставлено зі складу.

## Алгоритм

Реалізовано клас `EdmondsKarp`, який:

1. Зберігає **залишкову мережу** в структурі `cap[u][v]` (залишкова пропускна здатність).
2. Побудова графа — методом `add_edge(u, v, c)`.
3. Основний метод — `max_flow(s, t)`:
   - поки є шлях від `s` до `t` у залишковій мережі (шукаємо BFS),
   - знаходимо мінімальну залишкову ємність уздовж шляху (вузьке місце),
   - пропускаємо по шляху цей потік,
   - оновлюємо залишкові ємності (зменшуємо прямі, збільшуємо зворотні),
   - додаємо потік до загального значення.

Також є метод `get_flows()`, який повертає фактичні потоки по початкових ребрах.

## Запуск

```bash
cd task1_max_flow_algo
python3 max_flow_algo.py
```

Скрипт:

1. Створює граф логістичної мережі.
2. Обчислює максимальний потік від `S` до `T`.
3. Виводить:
   - значення максимального потоку;
   - потоки термінал → склади;
   - потоки склади → магазини;
   - таблицю «Термінал — Магазин».

## Результати

### Максимальний потік

Обчислений максимальний потік:

**115 одиниць товару.**

Це означає, що за наявних обмежень на пропускні здатності ребер більше 115 одиниць товару одночасно доставити від терміналів до магазинів **неможливо**.

### Потоки від терміналів до складів

Усі ребра термінал → склад повністю насичені:

- Термінал 1 → Склад 1: 25 / 25  
- Термінал 1 → Склад 2: 20 / 20  
- Термінал 1 → Склад 3: 15 / 15  
- Термінал 2 → Склад 3: 15 / 15  
- Термінал 2 → Склад 4: 30 / 30  
- Термінал 2 → Склад 2: 10 / 10  

Суми:

- через **Термінал 1** проходить 60 одиниць;
- через **Термінал 2** проходить 55 одиниць.

Разом: 60 + 55 = 115 (збігається з максимальним потоком).

### Потоки від складів до магазинів

Фактичні потоки:

- Склад 1 → Магазин 1: 5 / 15  
- Склад 1 → Магазин 2: 0 / 10  
- Склад 1 → Магазин 3: 20 / 20  

- Склад 2 → Магазин 4: 5 / 15  
- Склад 2 → Магазин 5: 0 / 10  
- Склад 2 → Магазин 6: 25 / 25  

- Склад 3 → Магазин 7: 20 / 20  
- Склад 3 → Магазин 8: 0 / 15  
- Склад 3 → Магазин 9: 10 / 10  

- Склад 4 → Магазин 10: 20 / 20  
- Склад 4 → Магазин 11: 0 / 10  
- Склад 4 → Магазин 12: 10 / 15  
- Склад 4 → Магазин 13: 0 / 5  
- Склад 4 → Магазин 14: 0 / 10  

Видно, що не всі ребра склад → магазин завантажені повністю — отже, обмеження сидять «вище» в мережі (на стороні терміналів).

### Зведена таблиця «Термінал — Магазин»

Для складів, що отримують товар з двох терміналів (Склад 2, Склад 3), потік від них до магазинів розподілявся **пропорційно** входу з кожного термінала.

Підсумкова таблиця (значення округлені до двох знаків):

| Термінал    | Магазин  | Потік |
|-------------|----------|-------|
| Термінал 1  | Магазин 1  | 5.00 |
| Термінал 1  | Магазин 2  | 0.00 |
| Термінал 1  | Магазин 3  | 20.00 |
| Термінал 1  | Магазин 4  | 3.33 |
| Термінал 1  | Магазин 5  | 0.00 |
| Термінал 1  | Магазин 6  | 16.67 |
| Термінал 1  | Магазин 7  | 10.00 |
| Термінал 1  | Магазин 8  | 0.00 |
| Термінал 1  | Магазин 9  | 5.00 |
| Термінал 1  | Магазин 10 | 0.00 |
| Термінал 1  | Магазин 11 | 0.00 |
| Термінал 1  | Магазин 12 | 0.00 |
| Термінал 1  | Магазин 13 | 0.00 |
| Термінал 1  | Магазин 14 | 0.00 |
| Термінал 2  | Магазин 1  | 0.00 |
| Термінал 2  | Магазин 2  | 0.00 |
| Термінал 2  | Магазин 3  | 0.00 |
| Термінал 2  | Магазин 4  | 1.67 |
| Термінал 2  | Магазин 5  | 0.00 |
| Термінал 2  | Магазин 6  | 8.33 |
| Термінал 2  | Магазин 7  | 10.00 |
| Термінал 2  | Магазин 8  | 0.00 |
| Термінал 2  | Магазин 9  | 5.00 |
| Термінал 2  | Магазин 10 | 20.00 |
| Термінал 2  | Магазин 11 | 0.00 |
| Термінал 2  | Магазин 12 | 10.00 |
| Термінал 2  | Магазин 13 | 0.00 |
| Термінал 2  | Магазин 14 | 0.00 |

Перевірка:

- сума потоків від Термінала 1 до всіх магазинів = 60;
- сума потоків від Термінала 2 до всіх магазинів = 55;
- разом = 115 = максимальний потік.

## Відповіді на запитання з умови

### 1. Які термінали забезпечують найбільший потік товарів до магазинів?

- **Термінал 1** — 60 одиниць.
- **Термінал 2** — 55 одиниць.

Найбільший потік іде через **Термінал 1**, але різниця між терміналами невелика.

---

### 2. Які маршрути мають найменшу пропускну здатність і як це впливає на загальний потік?

Найважливіші «вузькі місця» — **ребра між терміналами та складами**:

- усі ребра `Термінал → Склад` повністю насичені;
- сумарна пропускна здатність цього «зрізу» дорівнює 115 — саме вона й обмежує максимальний потік.

Малі ємності на деяких ребрах «Склад → Магазин» (наприклад, 5 одиниць на Склад 4 → Магазин 13) **не впливають на загальний максимум**, тому що потоку просто не вистачає, щоб повністю завантажити всі магазини.

---

### 3. Які магазини отримали найменше товарів і чи можна збільшити їх постачання?

Нульовий або дуже малий потік отримали:

- 0 одиниць: Магазин 2, 5, 8, 11, 13, 14;
- невеликі обсяги:
  - Магазин 1 — 5 / 15 можливих,
  - Магазин 4 — 5 / 15,
  - Магазин 12 — 10 / 15.

Для збільшення поставок **недостатньо** просто збільшити ємність ребер «Склад → Магазин» — більшість з них і так недозавантажені. Потрібно:

- збільшити пропускну здатність ребер **Термінал → Склад**;
- або додати нові шляхи постачання між терміналами та складами.

Тоді додатковий товар з'явиться на складах, а вже звідти його можна буде направити в «обділені» магазини.

---

### 4. Чи є вузькі місця, які можна усунути для покращення ефективності логістичної мережі?

Так, вузьке місце — **ділянка від терміналів до складів**:

- усі ребра Термінал 1/2 → Склади повністю заповнені;
- на ребрах Склад → Магазин є помітний запас.

З точки зору теорії мережевих потоків:

- максимальний потік = 115;
- існує мінімальний розріз (між {S, Термінал 1, Термінал 2} та рештою мережі) сумарною ємністю 115.

За теоремою про **максимальний потік і мінімальний розріз** це означає, що потік дійсно **оптимальний**, і збільшити його можна лише модернізувавши пропускну здатність ребер, які входять до мінімального розрізу — тобто ребра, що ведуть від джерела до терміналів та від терміналів до складів.